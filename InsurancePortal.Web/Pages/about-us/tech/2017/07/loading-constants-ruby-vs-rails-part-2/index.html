<!DOCTYPE html>
<html class="no-js" lang="en">

<!-- Mirrored from www.simplybusiness.co.uk/about-us/tech/2017/07/loading-constants-ruby-vs-rails-part-2/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Dec 2017 10:06:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"b747ade770","applicationID":"71452593","transactionName":"cVtfFhENWQlSQRxrXlxVRRACTWYAUldKAg1zRlIKChRQFg0JZ11UWht2JzdCVAdYRkcQCAhoHB5GUG4hU24aTUQdQFQBC00dPmkcDBtqGR0eSjg8GloUbhgRGBpvb01cQWhOHg==","queueTime":0,"applicationTime":86,"ttGuid":"","agentToken":null,"agent":""}</script>
<script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VQUCVFNWGwQBUFRQAggE"};window.NREUM||(NREUM={}),__nr_require=function(t,n,e){function r(e){if(!n[e]){var o=n[e]={exports:{}};t[e][0].call(o.exports,function(n){var o=t[e][1][n];return r(o||n)},o,o.exports)}return n[e].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<e.length;o++)r(e[o]);return r}({1:[function(t,n,e){function r(t){try{s.console&&console.log(t)}catch(n){}}var o,i=t("ee"),a=t(15),s={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(s.console=!0,o.indexOf("dev")!==-1&&(s.dev=!0),o.indexOf("nr_dev")!==-1&&(s.nrDev=!0))}catch(c){}s.nrDev&&i.on("internal-error",function(t){r(t.stack)}),s.dev&&i.on("fn-err",function(t,n,e){r(e.stack)}),s.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(s,function(t,n){return t}).join(", ")))},{}],2:[function(t,n,e){function r(t,n,e,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,n,e)])}catch(s){try{i("ierr",[s,c.now(),!0])}catch(u){}}return"function"==typeof f&&f.apply(this,a(arguments))}function UncaughtException(t,n,e){this.message=t||"Uncaught error with no additional information",this.sourceURL=n,this.line=e}function o(t){i("err",[t,c.now()])}var i=t("handle"),a=t(16),s=t("ee"),c=t("loader"),f=window.onerror,u=!1,d=0;c.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(8),t(7),"addEventListener"in window&&t(5),c.xhrWrappable&&t(9),u=!0)}s.on("fn-start",function(t,n,e){u&&(d+=1)}),s.on("fn-err",function(t,n,e){u&&(this.thrown=!0,o(e))}),s.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),s.on("internal-error",function(t){i("ierr",[t,c.now(),!0])})},{}],3:[function(t,n,e){t("loader").features.ins=!0},{}],4:[function(t,n,e){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(8),s=t(7),c="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",l="resource",p="-start",h="-end",m="fn"+p,w="fn"+h,v="bstTimer",y="pushState",g=t("loader");g.features.stn=!0,t(6);var b=NREUM.o.EV;o.on(m,function(t,n){var e=t[0];e instanceof b&&(this.bstStart=g.now())}),o.on(w,function(t,n){var e=t[0];e instanceof b&&i("bst",[e,n,this.bstStart,g.now()])}),a.on(m,function(t,n,e){this.bstStart=g.now(),this.bstType=e}),a.on(w,function(t,n){i(v,[n,this.bstStart,g.now(),this.bstType])}),s.on(m,function(){this.bstStart=g.now()}),s.on(w,function(t,n){i(v,[n,this.bstStart,g.now(),"requestAnimationFrame"])}),o.on(y+p,function(t){this.time=g.now(),this.startPath=location.pathname+location.hash}),o.on(y+h,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+c]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(l)]),window.performance["c"+c]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(l)]),window.performance["webkitC"+c]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],5:[function(t,n,e){function r(t){for(var n=t;n&&!n.hasOwnProperty(u);)n=Object.getPrototypeOf(n);n&&o(n)}function o(t){s.inPlace(t,[u,d],"-",i)}function i(t,n){return t[1]}var a=t("ee").get("events"),s=t(18)(a,!0),c=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";n.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,n){var e=t[1],r=c(e,"nr@wrapped",function(){function t(){if("function"==typeof e.handleEvent)return e.handleEvent.apply(e,arguments)}var n={object:t,"function":e}[typeof e];return n?s(n,"fn-",null,n.name||"anonymous"):e});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],6:[function(t,n,e){var r=t("ee").get("history"),o=t(18)(r);n.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],7:[function(t,n,e){var r=t("ee").get("raf"),o=t(18)(r),i="equestAnimationFrame";n.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],8:[function(t,n,e){function r(t,n,e){t[0]=a(t[0],"fn-",null,e)}function o(t,n,e){this.method=e,this.timerDuration=isNaN(t[1])?0:+t[1],t[0]=a(t[0],"fn-",this,e)}var i=t("ee").get("timer"),a=t(18)(i),s="setTimeout",c="setInterval",f="clearTimeout",u="-start",d="-";n.exports=i,a.inPlace(window,[s,"setImmediate"],s+d),a.inPlace(window,[c],c+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(c+u,r),i.on(s+u,o)},{}],9:[function(t,n,e){function r(t,n){d.inPlace(n,["onreadystatechange"],"fn-",s)}function o(){var t=this,n=u.context(t);t.readyState>3&&!n.resolved&&(n.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,y,"fn-",s)}function i(t){g.push(t),h&&(x?x.then(a):w?w(a):(E=-E,O.data=E))}function a(){for(var t=0;t<g.length;t++)r([],g[t]);g.length&&(g=[])}function s(t,n){return n}function c(t,n){for(var e in t)n[e]=t[e];return n}t(5);var f=t("ee"),u=f.get("xhr"),d=t(18)(u),l=NREUM.o,p=l.XHR,h=l.MO,m=l.PR,w=l.SI,v="readystatechange",y=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],g=[];n.exports=u;var b=window.XMLHttpRequest=function(t){var n=new p(t);try{u.emit("new-xhr",[n],n),n.addEventListener(v,o,!1)}catch(e){try{u.emit("internal-error",[e])}catch(r){}}return n};if(c(p,b),b.prototype=p.prototype,d.inPlace(b.prototype,["open","send"],"-xhr-",s),u.on("send-xhr-start",function(t,n){r(t,n),i(n)}),u.on("open-xhr-start",r),h){var x=m&&m.resolve();if(!w&&!m){var E=1,O=document.createTextNode(E);new h(a).observe(O,{characterData:!0})}}else f.on("fn-end",function(t){t[0]&&t[0].type===v||a()})},{}],10:[function(t,n,e){function r(t){var n=this.params,e=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!n.aborted){if(e.duration=a.now()-this.startTime,4===t.readyState){n.status=t.status;var i=o(t,this.lastSize);if(i&&(e.rxSize=i),this.sameOrigin){var c=t.getResponseHeader("X-NewRelic-App-Data");c&&(n.cat=c.split(", ").pop())}}else n.status=0;e.cbTime=this.cbTime,f.emit("xhr-done",[t],t),s("xhr",[n,e,this.startTime])}}}function o(t,n){var e=t.responseType;if("json"===e&&null!==n)return n;var r="arraybuffer"===e||"blob"===e||"json"===e?t.response:t.responseText;return h(r)}function i(t,n){var e=c(n),r=t.params;r.host=e.hostname+":"+e.port,r.pathname=e.pathname,t.sameOrigin=e.sameOrigin}var a=t("loader");if(a.xhrWrappable){var s=t("handle"),c=t(11),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,l=t("id"),p=t(14),h=t(13),m=window.XMLHttpRequest;a.features.xhr=!0,t(9),f.on("new-xhr",function(t){var n=this;n.totalCbs=0,n.called=0,n.cbTime=0,n.end=r,n.ended=!1,n.xhrGuids={},n.lastSize=null,p&&(p>34||p<10)||window.opera||t.addEventListener("progress",function(t){n.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,n){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&n.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,n){var e=this.metrics,r=t[0],o=this;if(e&&r){var i=h(r);i&&(e.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof n.onload))&&o.end(n)}catch(e){try{f.emit("internal-error",[e])}catch(r){}}};for(var s=0;s<d;s++)n.addEventListener(u[s],this.listener,!1)}),f.on("xhr-cb-time",function(t,n,e){this.cbTime+=t,n?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof e.onload||this.end(e)}),f.on("xhr-load-added",function(t,n){var e=""+l(t)+!!n;this.xhrGuids&&!this.xhrGuids[e]&&(this.xhrGuids[e]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,n){var e=""+l(t)+!!n;this.xhrGuids&&this.xhrGuids[e]&&(delete this.xhrGuids[e],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,n){n instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],n)}),f.on("removeEventListener-end",function(t,n){n instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],n)}),f.on("fn-start",function(t,n,e){n instanceof m&&("onload"===e&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,n){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,n],n)})}},{}],11:[function(t,n,e){n.exports=function(t){var n=document.createElement("a"),e=window.location,r={};n.href=t,r.port=n.port;var o=n.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("../../../../../index.html")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=n.hostname||e.hostname,r.pathname=n.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!n.protocol||":"===n.protocol||n.protocol===e.protocol,a=n.hostname===document.domain&&n.port===e.port;return r.sameOrigin=i&&(!n.hostname||a),r}},{}],12:[function(t,n,e){function r(){}function o(t,n,e){return function(){return i(t,[f.now()].concat(s(arguments)),n?null:this,e),n?void 0:this}}var i=t("handle"),a=t(15),s=t(16),c=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],l="api-",p=l+"ixn-";a(d,function(t,n){u[n]=o(l+n,!0,"api")}),u.addPageAction=o(l+"addPageAction",!0),u.setCurrentRouteName=o(l+"routeName",!0),n.exports=newrelic,u.interaction=function(){return(new r).get()};var h=r.prototype={createTracer:function(t,n){var e={},r=this,o="function"==typeof n;return i(p+"tracer",[f.now(),t,e],r),function(){if(c.emit((o?"":"no-")+"fn-start",[f.now(),r,o],e),o)try{return n.apply(this,arguments)}finally{c.emit("fn-end",[f.now()],e)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,n){h[n]=o(p+n)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],13:[function(t,n,e){n.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(n){return}}}},{}],14:[function(t,n,e){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),n.exports=r},{}],15:[function(t,n,e){function r(t,n){var e=[],r="",i=0;for(r in t)o.call(t,r)&&(e[i]=n(r,t[r]),i+=1);return e}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],16:[function(t,n,e){function r(t,n,e){n||(n=0),"undefined"==typeof e&&(e=t?t.length:0);for(var r=-1,o=e-n||0,i=Array(o<0?0:o);++r<o;)i[r]=t[n+r];return i}n.exports=r},{}],17:[function(t,n,e){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],18:[function(t,n,e){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(16),a="nr@original",s=Object.prototype.hasOwnProperty,c=!1;n.exports=function(t,n){function e(t,n,e,o){function nrWrapper(){var r,a,s,c;try{a=this,r=i(arguments),s="function"==typeof e?e(r,a):e||{}}catch(f){l([f,"",[r,a,o],s])}u(n+"start",[r,a,o],s);try{return c=t.apply(a,r)}catch(d){throw u(n+"err",[r,a,d],s),d}finally{u(n+"end",[r,a,c],s)}}return r(t)?t:(n||(n=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,n,o,i){o||(o="");var a,s,c,f="-"===o.charAt(0);for(c=0;c<n.length;c++)s=n[c],a=t[s],r(a)||(t[s]=e(a,f?s+o:o,i,s))}function u(e,r,o){if(!c||n){var i=c;c=!0;try{t.emit(e,r,o,n)}catch(a){l([a,e,r,o])}c=i}}function d(t,n){if(Object.defineProperty&&Object.keys)try{var e=Object.keys(t);return e.forEach(function(e){Object.defineProperty(n,e,{get:function(){return t[e]},set:function(n){return t[e]=n,n}})}),n}catch(r){l([r])}for(var o in t)s.call(t,o)&&(n[o]=t[o]);return n}function l(n){try{t.emit("internal-error",n)}catch(e){}}return t||(t=o),e.inPlace=f,e.flag=a,e}},{}],ee:[function(t,n,e){function r(){}function o(t){function n(t){return t&&t instanceof r?t:t?c(t,s,i):i()}function e(e,r,o,i){if(!l.aborted||i){t&&t(e,r,o);for(var a=n(o),s=h(e),c=s.length,f=0;f<c;f++)s[f].apply(a,r);var d=u[y[e]];return d&&d.push([g,e,r,a]),a}}function p(t,n){v[t]=h(t).concat(n)}function h(t){return v[t]||[]}function m(t){return d[t]=d[t]||o(e)}function w(t,n){f(t,function(t,e){n=n||"feature",y[e]=n,n in u||(u[n]=[])})}var v={},y={},g={on:p,emit:e,get:m,listeners:h,context:n,buffer:w,abort:a,aborted:!1};return g}function i(){return new r}function a(){(u.api||u.feature)&&(l.aborted=!0,u=l.backlog={})}var s="nr@context",c=t("gos"),f=t(15),u={},d={},l=n.exports=o();l.backlog=u},{}],gos:[function(t,n,e){function r(t,n,e){if(o.call(t,n))return t[n];var r=e();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(t,n,e){function r(t,n,e,r){o.buffer([t],r),o.emit(t,n,e)}var o=t("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(t,n,e){function r(t){var n=typeof t;return!t||"object"!==n&&"function"!==n?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");n.exports=r},{}],loader:[function(t,n,e){function r(){if(!x++){var t=b.info=NREUM.info,n=l.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&n))return u.abort();f(y,function(n,e){t[n]||(t[n]=e)}),c("mark",["onload",a()+b.offset],null,"api");var e=l.createElement("script");e.src="https://"+t.agent,n.parentNode.insertBefore(e,n)}}function o(){"complete"===l.readyState&&i()}function i(){c("mark",["domContent",a()+b.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(s=Math.max((new Date).getTime(),s))-b.offset}var s=(new Date).getTime(),c=t("handle"),f=t(15),u=t("ee"),d=window,l=d.document,p="addEventListener",h="attachEvent",m=d.XMLHttpRequest,w=m&&m.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1044.min.js"},g=m&&w&&w[p]&&!/CriOS/.test(navigator.userAgent),b=n.exports={offset:s,now:a,origin:v,features:{},xhrWrappable:g};t(12),l[p]?(l[p]("DOMContentLoaded",i,!1),d[p]("load",r,!1)):(l[h]("onreadystatechange",o),d[h]("onload",r)),c("mark",["firstbyte",s],null,"api");var x=0,E=t(17)},{}]},{},["loader",2,10,4,3]);</script>
<meta charset="utf-8">
<title>Loading Constants - Ruby VS Rails - Part 2</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="index, follow" name="robots">
<meta content="Two parts tutorial post on how constants are loaded in Ruby VS Ruby on Rails." name="description">
<meta content="Loading Constants - Ruby VS Rails - Part 2" property="og:title">
<meta content="article" property="og:type">
<meta content="https://www.simplybusiness.co.uk/about-us/tech/2017/07/loading-constants-ruby-vs-rails-part-2/" property="og:url">
<meta content="https://www.simplybusiness.co.uk/assets/social/simply_opengraph.png?v2" property="og:image">
<meta content="This is the second part of a two-parts blog post about how Ruby and Ruby on Rails treats constants. On Part I,
we have studied the way Ruby deals with constants. On this second part, we do the same for Ruby on Rails." property="og:description">
<meta content="summary_large_image" name="twitter:card">
<meta content="@simplybusiness" name="twitter:site">
<meta content="@simplybusiness" name="twitter:creator">
<link href="index.html" rel="canonical">
<meta content="authenticity_token" name="csrf-param">
<meta content="uywYjpi5zmVJaEGkgj4drxoluLjiJjs0zTscAzgRPWA=" name="csrf-token">
<link as="font" crossorigin="anonymous" href="../../../../../assets/bijou/museosans_500-5e970f19a7bd56681ccffee58a97772a148c314440e6549254733ef24a3c9f66.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin="anonymous" href="../../../../../assets/bijou/museosans_700-b3455e5afa9446a79ada31b9a416de55705fe7e7579989d1e3d6669c224a0bbc.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin="anonymous" href="../../../../../assets/bijou/museosansrounded_500-d1a96cb01de35edb2d86f7cbb3dd760310896e4f0cc7f0006e014b19c841b2d5.woff2" rel="preload" type="font/woff2">
<link as="font" crossorigin="anonymous" href="../../../../../assets/bijou/museosansrounded_700-205bdf3f5255bae942d055addbb1b09a6ba24b6a8440c688661fa524098745c1.woff2" rel="preload" type="font/woff2">

<link rel="stylesheet" href="../../../../../assets/app-1bf9710e98e8db69f25ae65e22f0a1cec3560d2d0d40a4d9528b872be60e937f.css">
<script src="../../../../../assets/app_head-fee1c8d1c4f037c1f4c940a637d8cd0a8879ab2faf9639ef06824e78ff0e1276.js"></script>
<script id="snippet-snowplow">
window.snowplowHelper = new SnowplowHelper({mainEventsCollector: "d1f6ajd7ltcrsx", bronzeEventsCollector: "d1y70ye8b3qgl6", avalancheCollector: "avalanche.simplybusiness.co.uk", cookieDomain: "simplybusiness.co.uk", appId: "uk-seedy"}).trackPageView();
</script>
<script id="snippet-bing">
(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:"5561972"};o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")},n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)},i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)})(window,document,"script","../../../../../../bat.bing.com/bat.js","uetq");
</script>
<noscript>
<img height="0" src="http://bat.bing.com/action/0?ti=5561972&amp;Ver=2" style="display:none; visibility: hidden;" width="0">
</noscript>
<script id="snippet-ga">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','../../../../../../www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-8804762-6', 'auto');
ga('require', 'displayfeatures');
ga('send', 'pageview');
</script>
<script id="snippet-facebook">
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','../../../../../../connect.facebook.net/en_US/fbevents.js');
fbq('init', '1451594908471230');
fbq('track', 'PageView');
fbq('trackCustom', 'UV');
</script>
<noscript>
<img height="1" src="https://www.facebook.com/tr?id=1451594908471230&amp;ev=PageView&amp;noscript=1" style="display:none" width="1">
</noscript>




<link href="../../../../../assets/bijou/favicon-e0e837edfd0650eeac6fdfd867d83745e6162b86a6edc3cb4f7eeae2b2d73aef.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
<link href="../../../../../assets/bijou/apple-icon-57x57-883fb33d5cf499cd7963527151cacbc2424428a35de4f745eeaa04810c5c95e8.png" rel="apple-touch-icon" sizes="57x57">
<link href="../../../../../assets/bijou/apple-icon-76x76-d405761bd30bd7a9039e9fb213c6f3c44f67e9d6c777e8b9cf30e1ecb57a9364.png" rel="apple-touch-icon" sizes="76x76">
<link href="../../../../../assets/bijou/apple-icon-120x120-64e89542bd90198b0978b07a45f61531d2231f632aa5bf1c716859c78f95b631.png" rel="apple-touch-icon" sizes="120x120">
<link href="../../../../../assets/bijou/apple-icon-152x152-1823375fa998e626ae10f3219d0c71ee4ff7e77f7fc3f47323801925859c6e14.png" rel="apple-touch-icon" sizes="152x152">
<link href="../../../../../assets/bijou/apple-icon-167x167-dc27d424ae184f34cbe4afa158929f59375cfc98477e201f3eb1fced390f0b23.png" rel="apple-touch-icon" sizes="167x167">
<link href="../../../../../assets/bijou/apple-icon-180x180-cfb96d969435ef742153d9b92b7327b0720fa95f3ac905c2cd47cd1731b91e2c.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../../../assets/bijou/icon-192x192-bd2f830632266cad764c388c8d11d7e9aea41bf8e8485bebf1209ac501f9e756.png" rel="icon" sizes="192x192">
<meta content="Simply Business" name="apple-mobile-web-app-title">
</head>
<body class="template-article" itemscope itemtype="https://schema.org/InsuranceAgency">




<header class="site-header" data-module="masthead">
<div class="site-header__top clearfix">
<div class="grid-wrapper">
<div class="site-header-logo">
<div class="site-header-logo__gradient js-has-css-animation"></div>
<a class="site-header-logo__link logo" href="../../../../../index.html" itemprop="url">
Simply Business - Insurance for your business
</a>
</div>
<div class="has-nav site-header__customer-service">
<div class="mobile-hide">
<strong class="site-header__phone-number qa-customer-service-number tel" id="customer-service-number" itemprop="telephone">0333 014 6683</strong>
<a class="qa-opening-hours" href="../../../../../support/index.html" itemprop="openingHours">See our opening hours</a>
</div>
<div class="mobile-show">
<a class="has-nav icon-phone js-notice-toggle qa-mobile-customer-service-number site-header__call-button" data-track="mobile_call_button" href="tel:0333 014 6683" id="qa-mobile-customer-service-button"></a>
</div>
</div>
</div>
<i class="site-header__menu-icon icon-menu desktop-hide js-menu-toggle"></i>
</div>
<nav class="primary-nav">
<div class="grid-wrapper">
<ul class="menu--top">
<li class="menu__item menu__item--menu js-submenu portable-hide">
<a class="menu__item-link" href="../../../../../insurance/index.html">Business insurance</a>
<div class="menu__panel-container">
<div class="menu__panel js-menu-panel">
<div class="grid-wrapper">
<div class="grid"><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../insurance/index.html">Business insurance</a>
</h3>
</div><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../insurance/covers/index.html">Business insurance covers</a>
</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../insurance/public-liability/index.html">Public liability insurance</a>
</li>
<li>
<a href="../../../../../insurance/professional-indemnity/index.html">Professional indemnity insurance</a>
</li>
<li>
<a href="../../../../../insurance/employers-liability/index.html">Employers' liability insurance</a>
</li>
<li>
<a href="../../../../../insurance/tool-cover/index.html">Tool insurance</a>
</li>
<li>
<a href="../../../../../insurance/business-contents/index.html">Business contents insurance</a>
</li>
<li>
<a href="../../../../../insurance/business-buildings/index.html">Business building insurance</a>
</li>
<li>
<a href="../../../../../insurance/personal-accident-insurance/index.html">Personal accident insurance</a>
</li>
<li>
<a href="../../../../../insurance/stock-cover/index.html">Stock insurance</a>
</li>
<li>
<a href="../../../../../insurance/covers/index.html">More business covers</a>
</li>
</ul>
</div><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../insurance/business-types/index.html">Insurance by business type</a>
</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../insurance/self-employed/index.html">Self-employed insurance</a>
</li>
<li>
<a href="../../../../../insurance/contractors/index.html">Contractor insurance</a>
</li>
<li>
<a href="../../../../../insurance/limited-company-insurance/index.html">Limited company insurance</a>
</li>
<li>
<a href="../../../../../insurance/home-business/index.html">Home business insurance</a>
</li>
<li>
<a href="../../../../../insurance/online-retailers/index.html">Online retailer insurance</a>
</li>
<li>
<a href="../../../../../insurance/consultants/index.html">Consultant insurance</a>
</li>
<li>
<a href="../../../../../insurance/freelancers/index.html">Freelancer insurance</a>
</li>
<li>
<a href="../../../../../insurance/sole-trader/index.html">Sole trader insurance</a>
</li>
<li>
<a href="../../../../../insurance/business-types/index.html">More business types</a>
</li>
</ul>
</div><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../insurance/by-industry/index.html">Insurance by trade</a>
</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../insurance/cleaners/index.html">Cleaners' insurance</a>
</li>
<li>
<a href="../../../../../insurance/hairdressers/index.html">Hairdressing insurance</a>
</li>
<li>
<a href="../../../../../insurance/catering/index.html">Catering insurance</a>
</li>
<li>
<a href="../../../../../insurance/photographers/index.html">Photographers' insurance</a>
</li>
<li>
<a href="../../../../../insurance/shop/index.html">Shop insurance</a>
</li>
<li>
<a href="../../../../../insurance/dog-walkers/index.html">Dog walking insurance</a>
</li>
<li>
<a href="../../../../../insurance/tradesman/index.html">Tradesman insurance</a>
</li>
<li>
<a href="../../../../../insurance/massage/index.html">Massage therapists' insurance</a>
</li>
<li>
<a href="../../../../../insurance/by-industry/index.html">More trades</a>
</li>
</ul>
</div></div>
</div>
</div>
</div>
</li>
<li class="menu__item menu__item--menu js-submenu portable-show">
<a class="menu__item-link" href="../../../../../insurance/index.html">Business insurance</a>
<div class="menu__panel-container">
<div class="menu__panel js-menu-panel">
<ul class="menu__sublist">
<li>
<a href="../../../../../insurance/index.html">Business insurance</a>
</li>
<li>
<a href="../../../../../insurance/public-liability/index.html">Public liability insurance</a>
</li>
<li>
<a href="../../../../../insurance/professional-indemnity/index.html">Professional indemnity insurance</a>
</li>
<li>
<a href="../../../../../insurance/employers-liability/index.html">Employers' liability insurance</a>
</li>
<li>
<a href="../../../../../insurance/tool-cover/index.html">Tool insurance</a>
</li>
<li>
<a href="../../../../../insurance/covers/index.html">More business covers</a>
</li>
<li>
<a href="../../../../../insurance/by-industry/index.html">Insurance by industry</a>
</li>
<li>
<a href="../../../../../insurance/business-types/index.html">Insurance by business type</a>
</li>
</ul>
</div>
</div>
</li>
<li class="menu__item menu__item--menu js-submenu portable-hide">
<a class="menu__item-link" href="../../../../../landlord-insurance/index.html">Landlord insurance</a>
<div class="menu__panel-container">
<div class="menu__panel js-menu-panel">
<div class="grid-wrapper">
<div class="grid"><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../landlord-insurance/index.html">Landlord insurance</a>
</h3>
</div><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../landlord-insurance/landlord-covers/index.html">Landlord insurance covers</a>
</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../landlord-insurance/buy-to-let-insurance/index.html">Buy-to-let insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/content-insurance/index.html">Landlord contents insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/loss-of-rent-insurance/index.html">Loss of rent insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/liability-insurance/index.html">Landlord liability insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/accidental-damage/index.html">Accidental damage insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/alternative-accommodation/index.html">Alternative accommodation insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/unoccupied-property-insurance/index.html">Unoccupied property insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/tenant-default-insurance/index.html">Tenant default insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/landlord-covers/index.html">More landlord covers</a>
</li>
</ul>
</div><div class="grid-cell desktop-3">
<h3>Property types</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../landlord-insurance/residential-landlord-insurance/index.html">Residential landlord insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/commercial-landlord-insurance/index.html">Commercial landlord insurance</a>
</li>
</ul>
</div></div>
</div>
</div>
</div>
</li>
<li class="menu__item menu__item--menu js-submenu portable-show">
<a class="menu__item-link" href="../../../../../landlord-insurance/index.html">Landlord insurance</a>
<div class="menu__panel-container">
<div class="menu__panel js-menu-panel">
<ul class="menu__sublist">
<li>
<a href="../../../../../landlord-insurance/index.html">Landlord insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/buy-to-let-insurance/index.html">Buy-to-let insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/content-insurance/index.html">Landlord contents insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/loss-of-rent-insurance/index.html">Loss of rent insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/liability-insurance/index.html">Landlord liability insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/accidental-damage/index.html">Accidental damage insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/unoccupied-property-insurance/index.html">Unoccupied property insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/landlord-covers/index.html">More covers</a>
</li>
</ul>
</div>
</div>
</li>
<li class="menu__item menu__item--menu js-submenu portable-hide">
<a class="menu__item-link" href="../../../../../knowledge/index.html">Knowledge centre</a>
<div class="menu__panel-container">
<div class="menu__panel js-menu-panel">
<div class="grid-wrapper">
<div class="grid"><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../knowledge/index.html">Knowledge centre</a>
</h3>
</div><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../knowledge/index.html">Articles</a>
</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../knowledge/popular-articles/index.html">Most popular articles</a>
</li>
<li>
<a href="../../../../../knowledge/index.html">All articles</a>
</li>
</ul>
</div><div class="grid-cell desktop-3">
<h3>
<a href="../../../../../microsites/index.html">Microsites</a>
</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../microsites/facebook-for-small-businesses/index.html">Facebook for small businesses</a>
</li>
<li>
<a href="../../../../../microsites/google-my-business-guide/index.html">Google My Business guide</a>
</li>
<li>
<a href="../../../../../microsites/google-analytics-guide/index.html">Google Analytics guide</a>
</li>
<li>
<a href="../../../../../microsites/google-adwords/index.html">Google Adwords guide</a>
</li>
<li>
<a href="../../../../../microsites/twitter-for-small-businesses/index.html">Twitter for small businesses</a>
</li>
<li>
<a href="../../../../../microsites/email-marketing-guide/index.html">Email marketing guide</a>
</li>
<li>
<a href="../../../../../microsites/guide-to-social-media-success/index.html">Guide to social media success</a>
</li>
<li>
<a href="../../../../../microsites/googleplus-for-small-businesses/index.html">GooglePlus for small businesses</a>
</li>
<li>
<a href="../../../../../microsites/index.html">More microsites</a>
</li>
</ul>
</div><div class="grid-cell desktop-3">
<h3>FAQ</h3>
<ul class="menu__sublist">
<li>
<a href="../../../../../insurance/faq/index.html">Business insurance FAQ</a>
</li>
<li>
<a href="../../../../../landlord-insurance/faq/index.html">Landlord insurance FAQ</a>
</li>
</ul>
</div></div>
</div>
</div>
</div>
</li>
<li class="menu__item menu__item--menu js-submenu portable-show">
<a class="menu__item-link" href="../../../../../knowledge/index.html">Knowledge centre</a>
<div class="menu__panel-container">
<div class="menu__panel js-menu-panel">
<ul class="menu__sublist">
<li>
<a href="../../../../../knowledge/index.html">Knowledge centre</a>
</li>
<li>
<a href="../../../../../knowledge/popular-articles/index.html">Most popular articles</a>
</li>
<li>
<a href="../../../../../microsites/index.html">Microsites</a>
</li>
<li>
<a href="../../../../../knowledge/resources/small-business-guides/index.html">Small business guides</a>
</li>
<li>
<a href="../../../../../insurance/faq/index.html">Business insurance FAQ</a>
</li>
<li>
<a href="../../../../../landlord-insurance/faq/index.html">Landlord insurance FAQ</a>
</li>
</ul>
</div>
</div>
</li>
<li class="menu__item">
<a class="menu__item-link" href="../../../../../support/index.html">Help & support</a>
</li>
<li class="menu__item">
<a class="menu__item-link qa-make-a-claim-menu" data-track="make_a_claim_button_clicked" href="../../../../../insurance-claims/index.html">Claims</a>
</li>
<li class="menu__item">
<a class="menu__item-link" data-track="sign_in_button_clicked" href="../../../../../signin/index.html">Sign in</a>
</li>
</ul>
</div>
</nav>




</header>
<section class="site-section grid-wrapper">
<div class="archive grid"><div class="archive__main grid-cell desktop-twothirds">
<article class="article" itemscope itemtype="https://schema.org/Blog">
<header class="article__header">
<div class="dateline" itemprop="datePublished">28 July 2017</div>
<h1 id="qa-page-heading" itemprop="name">Loading Constants - Ruby VS Rails (Part 2)</h1>
<p class="byline" itemprop="author">By Panos G. Matsinopoulos</p>

<div class="social-tools addthis_sharing_toolbox"></div>
</header>
<div class="article__body" itemprop="blogPost">
&#x000A;<p>This is the second part of a two-parts blog post about how Ruby and Ruby on Rails treats constants. On <a href="../loading-constants-ruby-vs-rails-part-1/index.html" >Part I</a>,&#x000A;we have studied the way Ruby deals with constants. On this second part, we do the same for Ruby on Rails.</p>&#x000A;&#x000A;<h2>Code Examples Used In This Post</h2>&#x000A;&#x000A;<p>This post is referencing lots of Ruby and Ruby on Rails code examples. You can find all the source code here:</p>&#x000A;&#x000A;<p><a target="_blank" href="https://github.com/simplybusiness/blog_code_examples/tree/master/loading_constants_ruby_vs_rails" >Loading Constants - Ruby vs Rails Code Examples Source Code</a></p>&#x000A;&#x000A;<h3>Table of Contents</h3>&#x000A;&#x000A;<h4><a href="../loading-constants-ruby-vs-rails-part-1/index.html" >Part I</a></h4>&#x000A;&#x000A;<ol>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#what-is-a-constant" >What Is a Constant in Ruby</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#ruby-keeps-track-of-constants-defined" >Ruby Keeps Track Of Constants Defined</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#object-constants" ><code >Object.constants</code></a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#accessing-undefined-constants" >Accessing Undefined Constants</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#which-piece-of-code-raises-the-name-error" >Which Piece of Code Raises the <code >NameError</code>?</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#another-method-to-check-that-a-constant-is-defined-or-not" >Another Method To Check that a Constant is Defined Or Not</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#removing-a-defined-constant" >Removing A Defined Constant</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#classes-and-modules-are-constants-too" >Classes And Modules Are Constants Too</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#nesting-and-constants" >Nesting And Constants</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#getting-the-nesting-path" >Getting the Nesting Path</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#how-constants-are-resolved-when-references-are-nested" >How Constants Are Resolved When References Are Nested?</a>&#x000A;    <ol>&#x000A;      <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#how-constants-are-resolved-when-references-are-nested-resolving-constants" >Resolving Constants</a>&#x000A;        <ol>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#resolving-constants-case-1-found-in-any-of-nesting-points" >Case #1 - Found in Any of Nesting Points</a></li>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#resolving-constants-case-2-found-in-ancestors-of-first-nesting-point" >Case #2 - Found in Ancestors of First Nesting Point</a></li>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#resolving-constants-case-3-found-in-object" >Case #3 - Found in Object</a></li>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#resolving-constants-case-in-which-constant-is-not-resolved" >Case #4 - Constant is Not Resolved</a></li>&#x000A;        </ol>&#x000A;      </li>&#x000A;      <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#references-that-are-qualified" >References that are Qualified</a>&#x000A;        <ol>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#references-that-are-qualified-constant-found-in-the-parent" >Constant Found in the Parent</a></li>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#references-that-are-qualified-constant-found-in-the-ancestors-of-parent" >Constant Found in the Ancestors of Parent</a></li>&#x000A;          <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#references-that-are-qualified-constant-is-not-looked-at-object" >Constant is not looked at at <code >Object</code></a></li>&#x000A;        </ol>&#x000A;      </li>&#x000A;    </ol>&#x000A;  </li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#overriding-const-missing-on-nested-cases" >Overriding <code >const_missing</code> on Nested Cases</a></li>&#x000A;  <li><a href="../loading-constants-ruby-vs-rails-part-1/index.html#const-missing-for-classes-and-modules" ><code >const_missing</code> for Classes and Modules</a></li>&#x000A;</ol>&#x000A;&#x000A;<h4>Part II</h4>&#x000A;&#x000A;<ol>&#x000A;  <li><a href="index.html#ruby-on-rails-constant-resolution" >Ruby On Rails - Constant Resolution</a></li>&#x000A;  <li><a href="index.html#application-entry-point" >Application Entry Point</a></li>&#x000A;  <li><a href="index.html#ruby-parsing-of-files-load-vs-require" >Ruby Parsing of Files - <code >load</code> vs <code >require</code></a></li>&#x000A;  <li><a href="index.html#rails-parsing-of-files-load-vs-require" >Rails Parsing of Files - <code >load</code> vs <code >require</code></a></li>&#x000A;  <li><a href="index.html#qualified-constants-autoloading-with-nesting" >Qualified Constants - Autoloading With Nesting</a></li>&#x000A;  <li><a href="index.html#add-folders-to-autoload-paths" >Add Folders to Autoload Paths</a></li>&#x000A;  <li><a href="index.html#how-does-rails-reloads-constants-in-development-environment" >How does Rails Reloads Constants in Development Environment?</a></li>&#x000A;  <li><a href="index.html#config-eager-load" ><code >config.eager_load</code></a></li>&#x000A;  <li><a href="index.html#how-does-rails-attaches-the-autoloading-mechanism-to-constant-missing-hook" >How Does Rails Attaches The Autoloading Mechanism to Constant Missing Hook?</a></li>&#x000A;  <li><a href="index.html#watch-out-for-require-and-require-relatives" >Watch Out for <code >requires</code> and <code >require_relatives</code></a></li>&#x000A;</ol>&#x000A;&#x000A;<h2 id="ruby-on-rails-constant-resolution">Ruby On Rails - Constant Resolution</h2>&#x000A;&#x000A;<p>All the things that we have learnt in <a href="../loading-constants-ruby-vs-rails-part-1/index.html" >Part I</a> apply to Ruby. But not to Ruby on Rails.&#x000A;Or, at least, not exactly as we have described it above. This is because RoR overrides the <code >Module#const_missing</code> method and&#x000A;uses another complex algorithm to finally load the constants, including an <em >autoloading</em> mechanism.</p>&#x000A;&#x000A;<h3 id="application-entry-point">Application entry point</h3>&#x000A;&#x000A;<p>Every Ruby application, even if it is a simple Ruby script, has a file which is its starting, entry point. Traditionally, this is called <code >main</code> in other&#x000A;languages, like Java or C. The Ruby interpreter will need this file in order to load and execute the commands of the application.</p>&#x000A;&#x000A;<p>Assume the following file <code >application-1/main.rb</code>:</p>&#x000A;&#x000A;<pre><code class="language-ruby"># File: application-1/main.rb&#x000A;#&#x000A;puts 'Hello World'&#x000A;</code></pre>&#x000A;&#x000A;<p>This file is the application entry point and we start the application by calling Ruby interpreter and giving as argument this specific file:</p>&#x000A;&#x000A;<pre><code class="language-bash">ruby application-1/main.rb&#x000A;Hello World&#x000A;</code></pre>&#x000A;&#x000A;<p>Ruby interpreter, takes one-by-one the Ruby statements inside the file and executes them, till it parses the whole file.</p>&#x000A;&#x000A;<p>Usually, we execute a Ruby application by giving the starting point Ruby file as the first argument to the <code >ruby</code> program. But, we can also make the&#x000A;application entry file be the actual <em >executable</em> Ruby program, i.e. calling that would internally invoke the Ruby interpreter, which would parse its content.&#x000A;This is how we do that:</p>&#x000A;&#x000A;<pre><code class="language-ruby">#!/usr/bin/env ruby&#x000A;#&#x000A;# File: application-1/main.rb&#x000A;#&#x000A;puts 'Hello World'&#x000A;&#x000A;</code></pre>&#x000A;<p>Watch for the line <code >1</code>, i.e. <code >#!/usr/bin/env ruby</code>. This will tell Unix shell to invoke <code >ruby</code> interpreter to further process the contents of the file.</p>&#x000A;&#x000A;<blockquote>&#x000A;  <p><strong >Important</strong> You need to have made the file <code >application-1/main</code> executable. This is how you can do that: <code >chmod +x application-1/main</code>.</p>&#x000A;</blockquote>&#x000A;&#x000A;<p>Now that you have done that, you can execute the <code >main</code> file itself:</p>&#x000A;&#x000A;<pre><code class="language-bash">application-1/main&#x000A;</code></pre>&#x000A;&#x000A;<p>and it will return exactly what the previous <code >ruby application-1/main.rb</code> did.</p>&#x000A;&#x000A;<h3 id="ruby-parsing-of-files-load-vs-require">Ruby Parsing of Files - <code >load</code> vs <code >require</code></h3>&#x000A;&#x000A;<p>Nevertheless, applications may be composed of thousands of Ruby statements. It is not practical to have all the application statements inside the same file.&#x000A;For that reason, we usually have different Ruby files hosting functional components and utilities of our application. When the Ruby statements we&#x000A;want to use are hosted in separate files, then, the <code >main.rb</code> file needs to ask Ruby interpreter to parse those files too. And, then, we say that&#x000A;<code >main.rb</code> file is <em >dependent</em> on these files, or these files are the dependencies of the <code >main.rb</code> file. This dependency may be recursive of course.&#x000A;Files that <code >main.rb</code> depends on might depend on other files too.</p>&#x000A;&#x000A;<p>How a Ruby file asks Ruby interpreter to include in its parsing another file, a dependent file? This is usually done with one of the 2 commands:</p>&#x000A;&#x000A;<ol>&#x000A;  <li><code >Kernel#require</code> (or <code >Kernel#require_relative</code>)</li>&#x000A;  <li><code >Kernel#load</code></li>&#x000A;</ol>&#x000A;&#x000A;<p>The main difference between the 2 being that <code >require</code> will not re-parse a file if asked multiple times. It parses it only once. On the other hand,&#x000A;<code >load</code> will parse the file multiple times, every time we are trying to parse a file with <code >load</code>, it will parse the content of the file.</p>&#x000A;&#x000A;<p>Let’s see the following example. It is composed of 3 files as follows:</p>&#x000A;&#x000A;<pre><code class="language-ruby"># File application-2/main.rb&#x000A;#&#x000A;$LOAD_PATH.unshift '.'&#x000A;&#x000A;require 'application-2/addition'&#x000A;load 'application-2/multiplication.rb'&#x000A;&#x000A;require 'application-2/addition'&#x000A;load 'application-2/multiplication.rb'&#x000A;&#x000A;puts Addition.new(5, 2).do&#x000A;puts Multiplication.new(5, 2).do&#x000A;</code></pre>&#x000A;&#x000A;<pre><code class="language-ruby"># File: application-2/addition.rb&#x000A;#&#x000A;puts 'Parsing addition.rb'&#x000A;&#x000A;class Addition&#x000A;  def initialize(a, b)&#x000A;    @a, @b = a, b&#x000A;  end&#x000A;&#x000A;  def do&#x000A;    @a + @b&#x000A;  end&#x000A;end&#x000A;</code></pre>&#x000A;&#x000A;<pre><code class="language-ruby"># File: application-2/multiplication.rb&#x000A;#&#x000A;puts 'Parsing multiplication.rb'&#x000A;&#x000A;class Multiplication&#x000A;  C = 5&#x000A;&#x000A;  def initialize(a, b)&#x000A;    @a, @b = a, b&#x000A;  end&#x000A;&#x000A;  def do&#x000A;    @a * @b + C&#x000A;  end&#x000A;end&#x000A;</code></pre>&#x000A;&#x000A;<p>If you run <code >ruby application-2/main.rb</code> you will get the following:</p>&#x000A;&#x000A;<pre><code class="language-bash">Parsing addition.rb&#x000A;Parsing multiplication.rb&#x000A;Parsing multiplication.rb&#x000A;/Users/pmatsino/projects/blog_posts/loading_constants_ruby_vs_rails/code_samples/application-2/multiplication.rb:6: warning: already initialized constant Multiplication::C&#x000A;/Users/pmatsino/projects/blog_posts/loading_constants_ruby_vs_rails/code_samples/application-2/multiplication.rb:6: warning: previous definition of C was here&#x000A;7&#x000A;15&#x000A;</code></pre>&#x000A;&#x000A;<p>This proves that the 2 <code >load</code> statements on the same file, i.e. the <code >application-2/multiplication.rb</code> asked Ruby interpreter to parse the file twice. On the other hand,&#x000A;the 2nd instance of <code >require</code> on the file <code >application-2/addition.rb</code> didn’t actually had any impact, i.e. the file was not parsed for a second time.</p>&#x000A;&#x000A;<p>Note also that the parsing of the <code >application-2/multiplication.rb</code> file for a second time had the side-effect of the constant <code >Multiplication:C</code>&#x000A;to be redefined, a fact that threw a warning on our console.</p>&#x000A;&#x000A;<h3 id="rails-parsing-of-files-load-vs-require">Rails Parsing of Files - <code >load</code> vs <code >require</code></h3>&#x000A;&#x000A;<p>Rails is not different to any other Ruby application with regards to how it parses files. It has a starting point which is the <code >rails</code> script&#x000A;and which first invokes the Ruby interpreter and then tries to parse the dependent files.</p>&#x000A;&#x000A;<p>It is not in the scope of this post to precisely teach you what is the exact Rails boot sequence. But here are some details:</p>&#x000A;&#x000A;<ol>&#x000A;  <li>First, the file <code >config/boot.rb</code> is required.</li>&#x000A;  <li>Some time later the file <code >config/application.rb</code> is required.</li>&#x000A;  <li>Then the <code >rails/all.rb</code> file requires some of the most important Rails files.</li>&#x000A;  <li>Then all the files that are specified in the <code >Gemfile</code> are required.</li>&#x000A;  <li>Then the <code >config/environment.rb</code> file is required.</li>&#x000A;  <li>Then all the initializers are being executed. One of them has to do with requiring the correct <code >config/environments/*.rb</code> file depending on the environment Rails has&#x000A;been bootstrapped in.</li>&#x000A;</ol>&#x000A;&#x000A;<p>The last step is critical, because inside the environment specific files, you configure the <code >cache_classes</code> application configuration variable.</p>&#x000A;&#x000A;<p>By default:</p>&#x000A;&#x000A;<ol>&#x000A;  <li>On <code >development</code> environment:&#x000A;    <ol>&#x000A;      <li>cache_classes = false</li>&#x000A;    </ol>&#x000A;  </li>&#x000A;  <li>On <code >production</code> environment:&#x000A;    <ol>&#x000A;      <li>cache_classes = true</li>&#x000A;    </ol>&#x000A;  </li>&#x000A;</ol>&#x000A;&#x000A;<p>Is this related to how Rails parses the files? Yes it is.</p>&#x000A;&#x000A;<p><code >cache_classes</code> <code >false</code>, means that when a file is not explicitly required with a <code >require</code> statement, but it is parsed due to the autoloading mechanism <sup>(see later on)</sup>, it&#x000A;will be <code >loaded</code> and not <code >required</code>. This is very useful while in <code >development</code> environment. You change something in your code and Rails reloads (and does not re-require)&#x000A;the files, reading the new content into Ruby memory, taking into account the changes, without you having to restart the Rails server/process.</p>&#x000A;&#x000A;<p><code >cache_classes</code> <code >true</code> is for the <code >production</code> environment. That makes sure that all code that is autoloaded it is loaded only once. Since no changes take place at&#x000A;the <code >production</code> environment, there is no reason not to cache the classes. The caching is actually implemented by the fact that whenever a file needs to be autoloaded,&#x000A;then it is <code >required</code> and not <code >loaded</code>.</p>&#x000A;&#x000A;<p>We will return back to this a little bit later. For now, keep in mind that</p>&#x000A;&#x000A;<ol>&#x000A;  <li>Whichever file is explicitly <code >required</code> or <code >loaded</code>, it is parsed as instructed (the <code >require</code> command requires the file, the <code >load</code> command loads the file).</li>&#x000A;  <li>There is an autoloading mechanism implemented by Rails that does either <code >require</code> or <code >load</code> depending on the <code >cache_classes</code> value.</li>&#x000A;</ol>&#x000A;&#x000A;<p>Now it’s time to talk about the autoloading mechanism.</p>&#x000A;&#x000A;<h3>Constants and Autoloading Mechanism</h3>&#x000A;&#x000A;<p>We are returning back to constants and, having talked about the differences between <code >require</code> and <code >load</code>, we are now ready to talk about how Rails resolves constants.</p>&#x000A;&#x000A;<p>Let’s suppose now that Rails parses the file <code >app/models/apple.rb</code>. Let’s assume also that the <code >app/models/apple.rb</code> file has the following content:</p>&#x000A;&#x000A;<pre><code class="language-ruby"># File rails-1/app/models/apple.rb&#x000A;#&#x000A;class Apple &lt; Fruit&#x000A;end&#x000A;</code></pre>&#x000A;&#x000A;<p>See the folder <code >rails-1</code> for this. The <code >app/models</code> folder does not contain any other file.</p>&#x000A;&#x000A;<p>If you run the command:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-1/bin/rails runner "require 'apple'"&#x000A;</code></pre>&#x000A;<p>you will get this:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-1/app/models/apple.rb:3:in `&lt;top (required)&gt;': uninitialized constant Fruit (NameError)&#x000A;... backtrace ...&#x000A;</code></pre>&#x000A;&#x000A;<p>which is expected, because the <code >Fruit</code> class/constant has never been defined in the past.</p>&#x000A;&#x000A;<p>Now look at the <code >rails-2</code> application. This one, has a <code >fruit.rb</code> file that defines the <code >Fruit</code> class. The file exists&#x000A;inside the folder <code >app/models</code>, and it has the following content:</p>&#x000A;&#x000A;<pre><code class="language-ruby"># File: rails-2app/models/fruit.rb&#x000A;#&#x000A;class Fruit&#x000A;end&#x000A;</code></pre>&#x000A;&#x000A;<p>Now, both <code >rails-2/app/models/apple.rb</code> and <code >rails-2/app/models/fruit.rb</code> exist together inside <code >rails-2/app/models</code>.</p>&#x000A;&#x000A;<p>Try to run this:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-2/bin/rails runner "require 'apple'"&#x000A;</code></pre>&#x000A;<p>Everything will run successfully, without any error this time. This means that Rails has managed to find and autoload the constant <code >Fruit</code>,&#x000A;from the file <code >app/models/fruit.rb</code>.</p>&#x000A;&#x000A;<p>How has this been achieved?</p>&#x000A;&#x000A;<p>Rails has an autoloading mechanism for missing constants. First, it has a set of paths that are called <code >autoload_paths</code>. By default, the paths are&#x000A;whatever is returned by this Rails command: <code >ActiveSupport::Dependencies.autoload_paths</code></p>&#x000A;&#x000A;<p>Let’s try that on the <code >rails-2</code> application:</p>&#x000A;&#x000A;<pre><code class="language-ruby">rails-2/bin/rails runner 'puts ActiveSupport::Dependencies.autoload_paths'&#x000A;</code></pre>&#x000A;&#x000A;<p>It will return this list here:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-2/app/assets&#x000A;rails-2/app/controllers&#x000A;rails-2/app/helpers&#x000A;rails-2/app/mailers&#x000A;rails-2/app/models&#x000A;rails-2/app/controllers/concerns&#x000A;rails-2/app/models/concerns&#x000A;rails-2/test/mailers/previews&#x000A;</code></pre>&#x000A;&#x000A;<p>As you can see, all the folders inside the <code >rails-2/app</code> folder are considered autoload folders. This means that any constant that is not found it is being&#x000A;looked inside the files on these folders.</p>&#x000A;&#x000A;<p>What exactly does Rails look in these folders? It looks for a file with name that <em >matches</em> the name of the constant that is trying to load. What does it mean <em >matches</em>?&#x000A;Well, it is very simple. The constant name is being send to <code >.underscore</code> command and the resulting string is suffixed with the filename extension <code >.rb</code>.</p>&#x000A;&#x000A;<p>Example: The constant <code >Fruit</code> is being turned to <code >fruit.rb</code>. Then Rails looks to find one of the following files, in this sequence:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-2/app/assets/fruit.rb&#x000A;rails-2/app/controllers/fruit.rb&#x000A;rails-2/app/helpers/fruit.rb&#x000A;rails-2/app/mailers/fruit.rb&#x000A;rails-2/app/models/fruit.rb&#x000A;rails-2/app/controllers/concerns/fruit.rb&#x000A;rails-2/app/models/concerns/fruit.rb&#x000A;rails-2/test/mailers/previews/fruit.rb&#x000A;</code></pre>&#x000A;&#x000A;<p>When it finds a file that matches, stops looking further and parses the file, expecting this file to define the constant <code >Fruit</code>. If the constant is not defined,&#x000A;even if the file is there, then an error is raised. On our <code >rails-2</code> example, the <code >fruit.rb</code> file has been found inside <code >app/models</code> folder. Also, the content of this&#x000A;file, <code >app/models/fruit.rb</code> defined the class, hence the constant <code >Fruit</code>, and everything was a success.</p>&#x000A;&#x000A;<p>Let’s see what happens if the file is found, but it does not define the expected constant. File <code >rails-3/app/models/fruit.rb</code> does not define the constant <code >Fruit</code>.</p>&#x000A;&#x000A;<p>Try to run this:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-3/bin/rails runner "require 'apple'"&#x000A;</code></pre>&#x000A;&#x000A;<pre><code class="language-bash">...activesupport-4.2.7.1/lib/active_support/dependencies.rb:495:in `load_missing_constant': Unable to autoload constant Fruit,&#x000A;expected ...rails-3/app/models/fruit.rb to define it (LoadError)&#x000A;</code></pre>&#x000A;&#x000A;<p>It is clear from the message, that the autoloading mechanism failed to load the constant. It was not defined inside the expected file <code >rails-3/app/models/fruit.rb</code>.</p>&#x000A;&#x000A;<h3 id="qualified-constants-autoloading-with-nesting">Qualified Constants - Autoloading With Nesting</h3>&#x000A;&#x000A;<p>Let’s look now at the following version of the <code >apple.rb</code> file:</p>&#x000A;&#x000A;<pre><code class="language-ruby"># File: rails-4/app/models/apple.rb&#x000A;#&#x000A;class Apple &lt; Com::Acme::DomainModel::Fruit&#x000A;end&#x000A;</code></pre>&#x000A;&#x000A;<p>As you can see, there is a reference to a qualified constant: <code >Com::Acme::DomainModel::Fruit</code>. What will happen if we try to parse <code >apple.rb</code> file?</p>&#x000A;&#x000A;<p>Try to run:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-4/bin/rails runner "require 'apple'"&#x000A;</code></pre>&#x000A;&#x000A;<p>You will get this:&#x000A;~~~ bash&#x000A;…/rails-4/app/models/apple.rb:3:in `&lt;top (required)&gt;’: uninitialized constant Com (NameError)&#x000A;~~~</p>&#x000A;&#x000A;<p>Rails tried first to locate the definition of the constant <code >Com</code> and didn’t find it. This is reasonable. It is the first constant mentioned inside the&#x000A;qualified reference <code >Com::Acme::DomainModel::Fruit</code> and it needs to be found first. Rails autoloading mechanism was triggered and Rails tried to find&#x000A;the file <code >com.rb</code> inside any of the autoload folders. It failed to find it and raised the <code >NameError</code>.</p>&#x000A;&#x000A;<p>We have various options to help Rails find the definition of this constant <code >Com</code>. One that we will use here is the implicit <code >Module</code> definition that&#x000A;is triggered when, instead of a file <code >com.rb</code> that would define the constant, a folder <code >com</code> is found. When the folder <code >com</code> is found as a sub-folder&#x000A;of one of the autoload paths, then Rails implicitly instantiates a module with name <code >Com</code>, and hence, the constant <code >Com</code>, from this point on, is defined.</p>&#x000A;&#x000A;<p><code >rails-5</code> project defines the folder <code >com</code> as a sub-folder of <code >rails-5/app/models</code>, which is part of the autoload paths. Let’s try to parse the same <code >apple.rb</code> content&#x000A;now.</p>&#x000A;&#x000A;<p>Try to run:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-5/bin/rails runner "require 'apple'"&#x000A;</code></pre>&#x000A;&#x000A;<p>You will get this:&#x000A;~~~ bash&#x000A;…/rails-5/app/models/apple.rb:3:in `&lt;top (required)&gt;’: uninitialized constant Com::Acme (NameError)&#x000A;~~~</p>&#x000A;&#x000A;<p>A new error that the constant <code >Com::Acme</code> is not defined. Great! The <code >Com</code> is now defined, thanks to the folder <code >rails-5/app/models/com</code>. We will use the same technique&#x000A;to define the constant <code >Com::Acme</code>. We will create the sub-folder <code >acme</code> inside the <code >com</code> folder. And, in order to avoid getting <code >NameError</code> for <code >Com::Acme::DomainModel</code>,&#x000A;we will also add the sub-folder <code >domain_model</code> inside the <code >acme</code> folder. Hence, we will have the folder branch: <code >rails-6/app/models/com/acme/domain_model</code>.&#x000A;This is where we will also create the file <code >fruit.rb</code> that would finally define the constant <code >Fruit</code>. Note that the new <code >fruit.rb</code> content, needs to be:</p>&#x000A;&#x000A;<pre><code class="language-ruby"># File: rails-6/app/models/com/acme/domain_model/fruit.rb&#x000A;#&#x000A;module Com&#x000A;  module Acme&#x000A;    module DomainModel&#x000A;      class Fruit&#x000A;      end&#x000A;    end&#x000A;  end&#x000A;end&#x000A;&#x000A;</code></pre>&#x000A;&#x000A;<p>since the <code >Fruit</code> should be defined inside the module <code >DomainModel, which is defined inside the module </code>Acme<code >, which is defined inside the module </code>Com`.</p>&#x000A;&#x000A;<p>Try to run:</p>&#x000A;&#x000A;<pre><code class="language-bash">rails-6/bin/rails runner "require 'apple'"&#x000A;</code></pre>&#x000A;&#x000A;<p>You should not get any error. And this proves how the autoloading mechanism works on Rails when we have qualified constants.</p>&#x000A;&#x000A;<h3 id="add-folders-to-autoload-paths">Add Folders to Autoload Paths</h3>&#x000A;&#x000A;<p>We have explained how the autoloading mechanism works on Rails. One of the critical ingredients here is the list of autoloaded paths. This can be&#x000A;altered at application configuration level. If you look inside your <code >config/application.rb</code> file, you will find the configuration variable</p>&#x000A;&#x000A;<p><code >config.autoload_paths</code></p>&#x000A;&#x000A;<p>Usually, one would like to add the <code >config/lib</code> folder as one more autoloading path. This can be done with a statement like:</p>&#x000A;&#x000A;<p><code >config.autoload_paths &lt;&lt; "#{config.root}/lib"</code></p>&#x000A;&#x000A;<h3 id="how-does-rails-reloads-constants-in-development-environment">How does Rails Reloads Constants in Development Environment?</h3>&#x000A;&#x000A;<p>As we said earlier Rails watches files for changes, while on development environment, and reloads them in order to avoid you having to restart the Rails&#x000A;server every time you do a change.</p>&#x000A;&#x000A;<p>Which piece of software does the watching of files? It is the middleware <code >ActionDispatch::Reloader</code> which is registered when <code >cache_classes</code> is <code >false</code>. This piece of&#x000A;code watches all the files inside the autoload_paths folders and their sub-folders. It also watches the <code >i18n</code> files and the routes definition files.</p>&#x000A;&#x000A;<p>Whenever any of these files changes, then, on next request to rails server, the files in these folders will be reloaded, whenever they are needed.</p>&#x000A;&#x000A;<p>How is this related to constants. Well, if any file is changed, then Rails, will call the <code >prepare</code> callbacks, before actually processing the incoming request.&#x000A;This will call the <code >ActiveSupport::FileUpdateChecker#execute</code> method. This will call</p>&#x000A;&#x000A;<pre><code>ActiveSupport::DescendantsTracker.clear&#x000A;ActiveSupport::Dependencies.clear&#x000A;</code></pre>&#x000A;&#x000A;<p>Both statements above, will remove the autoloaded constants, i.e. the constants that have been loaded with the autoloading mechanism&#x000A;described above.</p>&#x000A;&#x000A;<p>Hence, after every request that follows a change in any of the autoloaded paths files, all constants are being removed and will be&#x000A;redefined on-demand.</p>&#x000A;&#x000A;<p>Remember that on development environment the autoload files will be re-parsed using <code >load</code> commands and not <code >require</code> commands.</p>&#x000A;&#x000A;<h3 id="config-eager-load"><code >config.eager_load</code></h3>&#x000A;&#x000A;<p>On development environment, there is a configuration variable that is called <code >config.eager_load</code> and has the value <code >false</code> by default.&#x000A;Whereas on test and production environment, this value is <code >true</code>. What does this mean?</p>&#x000A;&#x000A;<p>There is a Rails initializer that deals with the <code >eager_load</code> value. With this value set to <code >true</code>, Rails will load all the Ruby files&#x000A;inside the <code >eager_load_paths</code> as defined in <code >config/application.rb</code> file. Note that by default, all the sub-folders of the <code >app</code> folder&#x000A;as inside the <code >eager_load_paths</code> folders. The load will be done with either <code >load</code> or <code >require</code> commands, depending on the&#x000A;<code >cache_classes</code> configuration variable. Note that, while Rails will be doing that, any constants that will need be resolved will be resolved&#x000A;with the autoloading mechanism as described above.</p>&#x000A;&#x000A;<h3 id="how-does-rails-attaches-the-autoloading-mechanism-to-constant-missing-hook">How Does Rails Attaches The Autoloading Mechanism to Constant Missing Hook?</h3>&#x000A;&#x000A;<p>As we have learnt earlier on this post, in order to customize the constant missing behaviour, one needs to redefine the <code >const_missing</code> method.</p>&#x000A;&#x000A;<p>As of today, this is done here: <code >.../ruby/gems/2.2.0/gems/activesupport-4.2.7.1/lib/active_support/dependencies.rb</code>. Inside this file,&#x000A;there is a module called <code >ModuleConstMissing</code> that defines the method <code >const_missing</code> as follows:</p>&#x000A;&#x000A;<pre><code class="language-ruby">def const_missing(const_name)&#x000A;  from_mod = anonymous? ? guess_for_anonymous(const_name) : self&#x000A;  Dependencies.load_missing_constant(from_mod, const_name)&#x000A;end&#x000A;</code></pre>&#x000A;&#x000A;<p>Then, later on on this file, there is a statement like this:</p>&#x000A;&#x000A;<pre><code class="language-ruby">Module.class_eval { include ModuleConstMissing }&#x000A;</code></pre>&#x000A;&#x000A;<p>which basically includes the <code >ModuleConstMissing</code> module inside the <code >Module</code> module and hence overriding/redefining the <code >const_missing</code> implementation.</p>&#x000A;&#x000A;<h3 id="watch-out-for-require-and-require-relatives">Watch Out for <code >requires</code> and <code >require_relatives</code></h3>&#x000A;&#x000A;<p>Due to the fact that Rails drops all constants and re-parses the files with a <code >load</code> statement while on development environment, this&#x000A;might give you some scratching-your-head moments wondering what is going wrong.</p>&#x000A;&#x000A;<p>For example, look at the rails project 7, <code >rails-7</code>. File <code >rails-7/app/models/fruit.rb</code> requires the file <code >rails-7/app/color.rb</code>, which defines the constant <code >ANOTHER_COLOR</code>.&#x000A;Everything goes well the first time the constant is referenced, inside the file <code >rails-7/app/models/fruit.rb</code> line 8.</p>&#x000A;&#x000A;<p>Start the server and send <code >curl http://localhost:3000</code>. You will see this on the Rails logs:</p>&#x000A;&#x000A;<pre><code>Started GET "/" for ::1 at 2016-10-04 14:46:31 +0100&#x000A;Processing by WelcomeController#index as */*&#x000A;start of fruit*************&#x000A;Printing ANOTHER_COLOR: red&#x000A;Completed 200 OK in 8ms (ActiveRecord: 0.0ms)&#x000A;</code></pre>&#x000A;&#x000A;<p>But, if you change any of your code on any of the autoload paths files and reissue a request to rails server being on development environment,&#x000A;it will throw away all the constants defined and will try to parse the files again. It will try to parse the&#x000A;<code >rails-7/app/models/fruit.rb</code> file and it will fail to find the constant on line 8.</p>&#x000A;&#x000A;<p>Change file <code >fruit.rb</code>, by adding an extra line at the end, for example. This will make sure that on the next request the reloading will take place. Send&#x000A;the <code >curl http://localhost:3000</code> request again. You will see the following on the Rails logs:</p>&#x000A;&#x000A;<pre><code class="language-bash">Started GET "/" for ::1 at 2016-10-04 14:53:11 +0100&#x000A;Processing by WelcomeController#index as */*&#x000A;start of fruit*************&#x000A;Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)&#x000A;&#x000A;NameError (uninitialized constant ANOTHER_COLOR):&#x000A;  app/models/fruit.rb:8:in `&lt;top (required)&gt;'&#x000A;  app/models/apple.rb:3:in `&lt;top (required)&gt;'&#x000A;  app/controllers/welcome_controller.rb:3:in `index'&#x000A;  ...&#x000A;</code></pre>&#x000A;&#x000A;<p>This is because the statement <code >require_relative '../color.rb'</code> will not parse the file again. Remember that <code >require</code> and <code >require_relative</code> commands parse the file once.&#x000A;Without the file <code >color.rb</code> being parsed while parsing the <code >fruit.rb</code> file for a second time, then constant will not be defined when parsing will reach line 8.</p>&#x000A;&#x000A;<p>The lesson learned here is that you should avoid using require statements to load the files. Try to rely on the autoloading mechanism of Rails.&#x000A;Alternatively, use <code >require_dependency</code> instead of <code >require</code>. <code >require_dependency</code> comes from <code >ActiveSupport::Dependencies</code> module and will actually do&#x000A;either ‘load’ or ‘require’ depending on the <code >cache_classes</code> variable. On development this is <code >false</code>, which means the <code >load</code> statement will be used, and hence, the&#x000A;file will be parsed again.</p>&#x000A;&#x000A;<p>Try to change the <code >require_relative</code> to <code >require_dependency</code> on the <code >rails-7</code> example (file <code >fruit.rb</code>). Do the experiment with Rails server on development environment&#x000A;again. You will see that second request does not fail anymore.</p>&#x000A;&#x000A;<h2>Closing Note</h2>&#x000A;&#x000A;<p>That was a long journey to Ruby and Ruby on Rails Constants handling. Hope that it has contributed to your knowledge around the subject.</p>&#x000A;&#x000A;<p>Also, don’t forget that your comments below are more than welcome. I am willing to answer any questions that you may have and give you feedback on any&#x000A;comments that you may post. I would like to have your feedback because I learn from you as much as you learn from me.</p>&#x000A;&#x000A;<h4>About the Author</h4>&#x000A;&#x000A;<p><a target="_blank" href="https://www.linkedin.com/in/panayotismatsinopoulos" >Panayotis Matsinopoulos</a> works as Lead Developer at <a href="../../../../../index.html" >Simply Business</a>&#x000A;and, on his free time, enjoys giving and taking classes about Web development at <a target="_blank" href="https://www.techcareerbooster.com/?utm_source=simply_business&amp;utm_medium=simply_business_tech_blog&amp;utm_campaign=blog_post_sb_ruby_constants_part_2" >Tech Career Booster</a>.</p>&#x000A;</div>
<footer class="article__footer">
<div class="social-tools addthis_sharing_toolbox"></div>
</footer>
</article>
<div class="comment-box">
<div id="disqus_thread"></div>
<script>
  var disqus_shortname = 'simplybusiness';
  var disqus_url = 'index.html';
  
  var original_orientation_change = window.onorientationchange;
  
  window.onorientationchange = function () {
    if (DISQUS) {
      DISQUS.reset({
        reload: true,
        config: function () {
          this.page.url = disqus_url;
        }
      });
    }
  
    if (original_orientation_change) {
      original_orientation_change();
    }
  };
  
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
</div>

</div><div class="grid-cell desktop-onethird">
<div class="newsletter-signup-module" id="qa-newsletter-signup-module">
<div class="newsletter-signup-module__content">
<h3>Join over 350,000 subscribers to our monthly newsletter</h3>
<p>
Keep up to date with the breaking news, guides and tips impacting your
business or rental.
</p>
<a class="btn small btn-primary" href="../../../../newsletter-signup/index.html" id="qa-newsletter-signup-module-cta">Subscribe</a>
</div>
</div>

<nav class="archive__nav" id="qa-archive-nav">

<div class="archive__nav-section qa-archive-nav-section" id="qa-archive-years-nav">
<h2>Archive</h2>
<ul class="in-columns">
<li>
<a href="/">2017</a>
</li>
<li>
<a href="../../../2016/index.html">2016</a>
</li>
<li>
<a href="../../../2015/index.html">2015</a>
</li>
<li>
<a href="../../../2014/index.html">2014</a>
</li>
<li>
<a href="../../../2013/index.html">2013</a>
</li>
<li>
<a href="../../../2012/index.html">2012</a>
</li>
</ul>
</div>

</nav>
</div></div>

</section>
<section class="site-section grid-wrapper sitemap">
<div class="grid"><div class="grid-cell desktop-onesixth tablet-onethird mobile-onehalf">
<div class="module">
<div class="module-content">
<h4>Insurance</h4>
<ul>
<li>
<a href="../../../../../insurance/public-liability/index.html">Public liability insurance</a>
</li>
<li>
<a href="../../../../../insurance/index.html">Business insurance</a>
</li>
<li>
<a href="../../../../../landlord-insurance/index.html">Landlord insurance</a>
</li>
<li>
<a href="../../../../../insurance/tradesman/index.html">Tradesman insurance</a>
</li>
<li>
<a href="../../../../../insurance/professionals/index.html">Professionals' insurance</a>
</li>
<li>
<a href="../../../../../insurance/shop/index.html">Shop insurance</a>
</li>
<li>
<a href="../../../../../insurance/restaurant/index.html">Restaurant insurance</a>
</li>
<li>
<a href="../../../../../vehicle/van-insurance/index.html">Van insurance</a>
</li>
<li>
<a href="../../../../../insurance/insurers/index.html">Insurers</a>
</li>
</ul>
</div>
</div>
</div><div class="grid-cell desktop-onesixth tablet-onethird mobile-onehalf">
<div class="module">
<div class="module-content">
<h4>About Simply Business</h4>
<ul>
<li>
<a href="../../../../index.html">About us</a>
</li>
<li>
<a href="../../../../team/index.html">Our team</a>
</li>
<li>
<a href="../../../../awards/index.html">Awards</a>
</li>
<li>
<a href="../../../../press-releases/index.html">Press releases</a>
</li>
<li>
<a href="../../../../../partner/index.html">Partners &amp; affiliates</a>
</li>
<li>
<a href="../../../../impact/index.html">Impact charity program</a>
</li>
<li>
<a href="../../../../../social/index.html">Social media</a>
</li>
</ul>
</div>
</div>
</div><div class="grid-cell desktop-onesixth tablet-onethird mobile-onehalf">
<div class="module">
<div class="module-content">
<h4>Careers</h4>
<ul>
<li>
<a href="../../../../careers/index.html">Careers at Simply Business</a>
</li>
<li>
<a href="../../../../careers/tech/index.html">Tech careers</a>
</li>
<li>
<a href="../../../../careers/jobs/index.html">Current vacancies</a>
</li>
</ul>
</div>
</div>
</div><div class="grid-cell desktop-onesixth tablet-onethird mobile-onehalf">
<div class="module">
<div class="module-content">
<h4>Customer support</h4>
<ul>
<li>
<a href="../../../../../support/index.html">Contact &amp; support</a>
</li>
<li>
<a href="../../../../../support/indexa064.html?topic=renewal">Policy renewal</a>
</li>
<li>
<a href="../../../../../insurance-claims/index.html">Make a claim</a>
</li>
<li>
<a href="../../../../../proof/index.html">Proof of policy</a>
</li>
<li>
<a href="../../../../../support/complaints/index.html">Complaints</a>
</li>
</ul>
</div>
</div>
</div><div class="grid-cell desktop-onesixth tablet-onethird mobile-onehalf">
<div class="module">
<div class="module-content">
<h4>Benefits</h4>
<ul>
<li>
<a href="../../../../../support/customer-benefits/index.html">Benefits</a>
</li>
<li>
<a href="../../../../refer/index.html">Refer a friend</a>
</li>
<li>
<a href="../../../../../finance/index.html">Finance</a>
</li>
</ul>
</div>
</div>
</div><div class="grid-cell desktop-onesixth tablet-onethird mobile-onehalf">
<div class="module">
<div class="module-content">
<h4>Knowledge</h4>
<ul>
<li>
<a href="../../../../../knowledge/index.html">Knowledge centre</a>
</li>
<li>
<a href="../../../../../knowledge/opinion/index.html">Opinions</a>
</li>
<li>
<a href="../../../../../microsites/index.html">Microsites</a>
</li>
<li>
<a href="../../../../../leaderboards/top-100-influencers-small-business/index.html">Business 100 leaderboard</a>
</li>
<li>
<a href="../../../../../leaderboards/top-100-influencers-property/index.html">Property 100 leaderboard</a>
</li>
</ul>
</div>
</div>
</div></div>
</section>




<footer class="site-footer">
<div class="grid-wrapper">
<div class="grid"><div class="grid-cell desktop-onethird tablet-onehalf vcard">
<h3 class="fn">Address</h3>
<p>
<span class="adr" itemprop="address">
99 Gresham Street<br>
London<br>
EC2V 7NG
</span>
</p>
<p>
<span class="adr" itemprop="address">
Sol House<br>
29 St Katherine's Street<br>
Northampton<br>
NN1 2QZ
</span>
</p>
</div><div class="grid-cell desktop-twothirds tablet-onehalf">
<div class="grid desktop-reverse"><div class="grid-cell desktop-onethird legal">
<h3>Legal</h3>
<ul>
<li>
<a href="../../../../../terms-conditions/index.html" target="">Terms &amp; conditions</a>
</li>
<li>
<a href="../../../../../privacy-policy/index.html" target="">Privacy policy</a>
</li>
<li>
<a href="../../../../../legal/cookies/index.html" target="">Cookie policy</a>
</li>
<li>
<a href="../../../../../sitemap/index.html" target="">Site map</a>
</li>
</ul>
</div><div class="grid-cell desktop-twothirds newsletter">
<h3>Newsletter</h3>
<p>
Sign up to get our monthly newsletter, jam-packed with industry news, tips and events.
</p>
<a class="btn-tertiary" href="../../../../newsletter-signup/index.html" target="">Subscribe</a>
</div></div>
</div>
</div>
</div>
<div class="small-print">
<div class="grid-wrapper">
<p>
&copy; Copyright 2017 Simply Business. All Rights Reserved.
Simply Business is a trading name of Xbridge Limited which is authorised and
regulated by the Financial Conduct Authority (Financial Services Registration
No: 313348). Xbridge Limited (No: 3967717) has its registered office at
99 Gresham Street, London EC2V 7NG.
</p>
</div>
</div>
</footer>
<script src="../../../../../assets/app-eda58eafa7598e80d09818bcdb51d1bc8b5fd8ad045ebf777e843726ae3171b3.js"></script>
<script id="snippet-twitter" src="../../../../../../static.ads-twitter.com/oct.js"></script>
<script>
  if (window.twttr) twttr.conversion.trackPid('l65zb', { tw_sale_amount: 0, tw_order_quantity: 0 });
</script>
<noscript>
<img alt="" height="1" src="https://analytics.twitter.com/i/adsct?txn_id=l65zb&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0" style="display:none;" width="1">
<img alt="" height="1" src="http://t.co/i/adsct?txn_id=l65zb&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0" style="display:none;" width="1">
</noscript>
<script id="snippet-addthis" src="../../../../../../s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4e98360a319de2dd"></script>
<script id="snippet-linkedin">
var _bizo_data_partner_id = "7577";
(function() {
var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";
b.async = true;
b.src = (window.location.protocol === "https:" ? "https://sjs" : "http://js") + ".bizographics.com/insight.min.js";
s.parentNode.insertBefore(b, s);
})();
</script>
<noscript>
<img height="1" src="http://www.bizographics.com/collect/?pid=7577&amp;fmt=gif" style="display:none;" width="1">
</noscript>
<!-- begin usabilla live embed code -->
<script id="snippet-usabilla">
window.lightningjs||function(c){function g(b,d){d&&(d+=(/\?/.test(d)?"&":"?")+"lv=1");c[b]||function(){var i=window,h=document,j=b,g=h.location.protocol,l="load",k=0;(function(){function b(){a.P(l);a.w=1;c[j]("_load")}c[j]=function(){function m(){m.id=e;return c[j].apply(m,arguments)}var b,e=++k;b=this&&this!=i?this.id||0:0;(a.s=a.s||[]).push([e,b,arguments]);m.then=function(b,c,h){var d=a.fh[e]=a.fh[e]||[],j=a.eh[e]=a.eh[e]||[],f=a.ph[e]=a.ph[e]||[];b&&d.push(b);c&&j.push(c);h&&f.push(h);return m};return m};var a=c[j]._={};a.fh={};a.eh={};a.ph={};a.l=d?d.replace(/^\/\//,(g=="https:"?g:"http:")+"//"):d;a.p={0:+new Date};a.P=function(b){a.p[b]=new Date-a.p[0]};a.w&&b();i.addEventListener?i.addEventListener(l,b,!1):i.attachEvent("on"+l,b);var q=function(){function b(){return["<head></head><",c,' onload="var d=',n,";d.getElementsByTagName('head')[0].",d,"(d.",g,"('script')).",i,"='",a.l,"'\"></",c,">"].join("")}var c="body",e=h[c];if(!e)return setTimeout(q,100);a.P(1);var d="appendChild",g="createElement",i="src",k=h[g]("div"),l=k[d](h[g]("div")),f=h[g]("iframe"),n="document",p;k.style.display="none";e.insertBefore(k,e.firstChild).id=o+"-"+j;f.frameBorder="0";f.id=o+"-frame-"+j;/MSIE[ ]+6/.test(navigator.userAgent)&&(f[i]="javascript:false");f.allowTransparency="true";l[d](f);try{f.contentWindow[n].open()}catch(s){a.domain=h.domain,p="javascript:var d="+n+".open();d.domain='"+h.domain+"';",f[i]=p+"void(0);"}try{var r=f.contentWindow[n];r.write(b());r.close()}catch(t){f[i]=p+'d.write("'+b().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};a.l&&setTimeout(q,0)})()}();c[b].lv="1";return c[b]}var o="lightningjs",k=window[o]=g(o);k.require=g;k.modules=c}({});
if(!navigator.userAgent.match(/Android|BlackBerry|BB10|iPhone|iPad|iPod|Opera Mini|IEMobile/i)) {window.usabilla_live = lightningjs.require("usabilla_live", "../../../../../../w.usabilla.com/d9aa21c6f852.js"); } else {window.usabilla_live = lightningjs.require("usabilla_live", "../../../../../../w.usabilla.com/c627832b68ee.js"); }
window.usabilla_live('data', {custom: {domain_userid: 'd05a8d5d8c09756c'}});
</script>
<!-- end usabilla live embed code -->




</body>

<!-- Mirrored from www.simplybusiness.co.uk/about-us/tech/2017/07/loading-constants-ruby-vs-rails-part-2/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Dec 2017 10:06:35 GMT -->
</html>

