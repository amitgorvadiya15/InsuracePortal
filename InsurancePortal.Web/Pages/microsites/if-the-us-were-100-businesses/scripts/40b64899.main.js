$(function(){"use strict";function a(a){for(var b=1e6;b>=10;b/=10)if(a>10*b)return Math.round(a/b)*b;return Math.round(a)}function b(b){var c={M:1e6,K:1e3};for(var d in c)if(b>c[d])return a(b)/c[d]+d;return Math.round(b)}function c(a,b){var c=.5;return v>20?c=3:v>4?c=1.5:v>2&&(c=1),Modernizr.mq("(max-width: 500px)")&&(c=1.5*c,v>4&&(c=2*c)),{width:a,height:b||c*a*n}}function d(){return Modernizr.mq("(min-width: 1000px)")?900:s}function e(){return(t.width-w.width)/2}function f(a){return a?a.replace(/(?:^\w|\&|[A-Z]|\b\w|\s+)/g,function(a,b){return 0===+a?"":"&"===a?"And":0===b?a.toLowerCase():a.toUpperCase()}):void 0}function g(){if(!Modernizr.svg)return void l.detach().insertAfter(".about").show().find(".sources").hide();var a="US"===u?"scripts/6d799b17.us.json":"scripts/68f189ed.uk.json";j.load(function(){d3.json(a,function(a){i(a),k.find("#loading").html("&hellip;there would be&hellip;")})}),$.slidebars()}function h(a){function b(a){var b=_.chain(a).map(function(a,b){return a.order=b,a.value=1,_.range(a.n).map(function(){return a.name})}).flatten().value();if(b.length<o){var c=o-b.length,d=_.range(c).map(function(){return""});b=b.concat(d)}return _.shuffle(b)}var c={};return _.each(x,function(d){c[d]=b(a[d])}),d3.range(o).map(function(a){var b={radius:6,reset:c.reset[a]};return _.each(x,function(d){b[d]=c[d][a]}),b})}function i(a){function b(b,d){var e=a[b]||[];_.contains(_.pluck(F,b),"")&&(e=e.concat({name:"",value:1})),v=e.length,w=c(d);var f=d3.layout.grid(e).size([w.width,w.height]).bands();w.width<600&&e.length>1?f.cols(2):e.length>30&&f.cols(5);var g=f.nodeSize();return e=f(e).map(function(a){return a.dx=g[0],a.dy=g[1],a})}function g(c){if(C(),"conclusion"===c||!c)return k.slideUp(500),void l.fadeIn(600);k.slideDown(300),l.fadeOut(200);var g=d(),h=b(c,g);t.height=w.height>g?w.height:g,H.transition().attr("height",t.height+D.top),D.left=e(),I.attr("transform","translate("+D.left+","+D.top+")"),G.on("tick",i(h,c)),n(h),J.attr("class",function(b){var d=_.find(a[c],function(a){return a.name===b[c]});return h.length>4?"center0":"location"===c&&"UK"===u?f(b[c]):d?"center"+d.order:void 0}).classed("visible",function(a){return"reset"===c||""!==a[c]}),G.resume()}function i(a,b){var c={};return _.each(a,function(a){c[a.name]=a}),function(a){for(var d=a.alpha*r,e=0;o>e;e++){var f=F[e],g=c[f[b]],h={x:g.x+g.dx/2,y:g.y+g.dy/2};f.x+=(h.x-f.x)*d,f.y+=(h.y-f.y)*d}J.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}}function n(a){I.selectAll(".label").remove(),I.selectAll(".label").data(a).enter().append("text").attr("class","label").attr("text-anchor","middle").text(z).attr("x",function(a){return a.x}).attr("dx",function(a){return a.dx/2}).attr("y",function(a){return a.y}).attr("dy",function(){return 20}).call(A).style("opacity",0).transition().duration(500).style("opacity",1)}function z(b){var c,d=x[y];switch(d){case"location":case"industry":c=" in ";break;case"employee":c=" with ";break;case"age":c=" that are ";break;case"money":c=" that turn over ";break;default:c=" "}var e=a[d];if(e){var f=_.find(e,function(a){return a.name===b.name});return f.n+c+b.name}}function A(a){a.each(function(){var a,b=d3.select(this),c=b.text().split(/\s+/).reverse(),d=[],e=b.attr("x"),f=parseFloat(b.attr("dy")),g=2*parseFloat(b.attr("dx")),h=b.text(null).append("tspan").attr("x",e).attr("dx",g/2).attr("dy",f);_.each(c,function(){a=c.pop(),d.push(a),h.text(d.join(" ")),h.node().getComputedTextLength()>g&&(d.pop(),h.text(d.join(" ")),d=[a],h=b.append("tspan").attr("x",e).attr("dx",g/2).attr("dy",f).text(a))})})}function B(a){return y+=a,0>y&&(y=0),y>=x.length?(y=x.length,"conclusion"):x[y]}function C(){var a=y/x.length*100+"%";m.stop().animate({width:a},500),$("#prev").toggleClass("disabled",0>=y),$("#next").toggleClass("disabled",y>=x.length)}var D={top:50,right:0,bottom:0,left:e()},E={radius:0,fixed:!0},F=h(a);F.push(E);var G=d3.layout.force().gravity(p).charge(function(a){return 0!==a.radius?q:10*q}).nodes(F).size([w.width,w.height]);G.start();var H=d3.select("#force").append("svg").attr("width",t.width).attr("height",t.height+D.top).style("top",-D.top+"px"),I=H.append("g").attr("transform","translate("+D.left+","+D.top+")"),J=I.selectAll("circle").data(F).enter().append("circle").attr("r",function(a){return a.radius});g(x[y]),E.px=0,E.py=0,H.on("mousemove",function(){var a=d3.mouse(this);E.px=a[0]-D.left,E.py=a[1]-D.top,G.resume()}),$("#dir").on("click","a",function(a){a.preventDefault();var b="next"===this.id?1:-1,c=B(b);g(c)}),$(document).on("keyup",function(a){var b=a.which||a.keyChar||a.keyCode;37===b?g(B(-1)):39===b?g(B(1)):27===b&&(y=0,g("reset"))}),$("main").swipe({swipeLeft:function(){g(B(1))},swipeRight:function(){g(B(-1))}});var K,L={time:50,width:50};j.resize(function(){return s=j.width(),Math.abs(t.width-s)<L.width?!1:(clearTimeout(K),void(K=setTimeout(function(){t.width=s,g(x[y]),H.attr("width",t.width)},L.time)))})}var j=$(window),k=$("#force"),l=$("#conclusion"),m=$("#progress"),n=.8,o=100,p=0,q=-10,r=.11,s=j.width(),t={width:s,height:d()},u=$("body").attr("class"),v=1,w=c(t.height),x=["reset","gender","location","industry","age","money","employee"],y=0,z=$("#embed");$(".embedLink").on("click",function(a){a.preventDefault(),z.hasClass("visible")?z.animate({bottom:"-200px"},200).fadeOut({queue:!1}).removeClass("visible"):z.animate({bottom:"0px"},350).fadeIn({queue:!1}).addClass("visible")}),window.location===window.parent.location&&Modernizr.csstransitions&&$(".social-likes").show().socialLikes().on("counter.social-likes",function(a,c,d){d>0&&$(".social-likes__counter_"+c).text(b(d))}),g()});var socialLikesButtons={linkedin:{counterUrl:"https://www.linkedin.com/countserv/count/share?url={url}",counter:function(a,b){"use strict";var c=socialLikesButtons.linkedin;c._||(c._={},window.IN||(window.IN={Tags:{}}),window.IN.Tags.Share={handleCount:function(a){var b=c.counterUrl.replace(/{url}/g,encodeURIComponent(a.url));c._[b].resolve(a.count)}}),c._[a]=b,$.getScript(a).fail(b.reject)},popupUrl:"https://www.linkedin.com/shareArticle?mini=false&url={url}&title={title}",popupWidth:650,popupHeight:500}};